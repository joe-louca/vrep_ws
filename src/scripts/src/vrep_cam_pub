function sysCall_init()
    -- Get handles
    visionSensorHandle=sim.getObjectHandle('camera1_sensor')
    
    -- Enable image publisher
    if simROS then
        clock_pub=simROS.advertise('/clock','rosgraph_msgs/Clock')
        simROS.publisherTreatUInt8ArrayAsString(clock_pub)
        
        cam1_pub=simROS.advertise('/cam1', 'sensor_msgs/Image')
        simROS.publisherTreatUInt8ArrayAsString(cam1_pub) -- treat uint8 arrays as strings
    end
end

function sysCall_sensing()
    if simROS then   
        simROS.publish(clock_pub,{clock=sim.getSystemTime()})

        -- Get visual stream    
        sim.handleVisionSensor(visionSensorHandle)
        local image,w,h=sim.getVisionSensorCharImage(visionSensorHandle)

        -- Build message
        d={}
        d['header']={stamp=sim.getSystemTime(), frame_id="cam1"}
        d['height']=h
        d['width']=w
        d['encoding']='rgb8'
        d['is_bigendian']=1
        d['step']=w*3
        d['data']=image
        
        -- Publish image to rostopic
        simROS.publish(cam1_pub, d)
    end
end

function sysCall_cleanup()
    if simROS then
        simROS.shutdownPublisher(cam1_pub)
        simROS.shutdownPublisher(clock_pub)
    end
end


